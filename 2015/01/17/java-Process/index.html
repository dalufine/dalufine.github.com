<!DOCTYPE html>
<html lang="zh-Hans">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="大路" />



<meta name="description" content="When Runtime.exec() won’tNavigate yourself around pitfalls related to the Runtime.exec() method

SummaryIn this installment of Java Traps, Michael Daconta discusses one new pitfall and revisits anothe">
<meta property="og:type" content="article">
<meta property="og:title" content="java.lang.Process 阻塞问题 & Runtime.exec()的陷阱">
<meta property="og:url" content="http://dalufan.com/2015/01/17/java-Process/index.html">
<meta property="og:site_name" content="道听途说">
<meta property="og:description" content="When Runtime.exec() won’tNavigate yourself around pitfalls related to the Runtime.exec() method

SummaryIn this installment of Java Traps, Michael Daconta discusses one new pitfall and revisits anothe">
<meta property="og:updated_time" content="2015-01-17T10:44:12.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="java.lang.Process 阻塞问题 & Runtime.exec()的陷阱">
<meta name="twitter:description" content="When Runtime.exec() won’tNavigate yourself around pitfalls related to the Runtime.exec() method

SummaryIn this installment of Java Traps, Michael Daconta discusses one new pitfall and revisits anothe">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="道听途说" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>java.lang.Process 阻塞问题 &amp; Runtime.exec()的陷阱 | 道听途说</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>





    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?d139b23707f5aa48a2430a8a9e8977ba";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>


</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">大路</a></h1>
        </hgroup>

        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="Mailto:dalufine@163.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="https://github.com/dalufine" title="GitHub"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Activity/">Activity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AlarmManager/">AlarmManager</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AtomicInteger/">AtomicInteger</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bitmap/">Bitmap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BroadcastReceiver/">BroadcastReceiver</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ContentObserver/">ContentObserver</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ContentProvider/">ContentProvider</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Context/">Context</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DownloadManager/">DownloadManager</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Drawable/">Drawable</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Enum/">Enum</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/EventBus/">EventBus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Fragment/">Fragment</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Generics/">Generics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gradle/">Gradle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Handler/">Handler</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HttpClient/">HttpClient</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ImageView/">ImageView</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Intent/">Intent</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ListView/">ListView</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MediaPlayer/">MediaPlayer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MediaRecorder/">MediaRecorder</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MotionEvent/">MotionEvent</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RecycleView/">RecycleView</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Retrofit/">Retrofit</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Serializable/">Serializable</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Service/">Service</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Smali/">Smali</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SparseArray/">SparseArray</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/String/">String</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/StringBuffer/">StringBuffer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sublime/">Sublime</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TextView/">TextView</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ThreadPoolExecutor/">ThreadPoolExecutor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UIImageView/">UIImageView</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Uri/">Uri</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/View/">View</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ViewPager/">ViewPager</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebView/">WebView</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Xutils/">Xutils</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zxing/">Zxing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/animator/">animator</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/app/">app</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/as/">as</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/autolayout/">autolayout</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/canvas/">canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cookie/">cookie</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dex/">dex</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/diff/">diff</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/eclipse/">eclipse</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/email/">email</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/error/">error</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/example/">example</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/excel/">excel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/final/">final</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gc/">gc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/issues/">issues</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/join/">join</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/knowledge/">knowledge</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mat/">mat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/net/">net</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/note/">note</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/optimization/">optimization</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/permission/">permission</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/process/">process</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ragment/">ragment</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reconsitution/">reconsitution</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reflect/">reflect</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/regex/">regex</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rn/">rn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scrollView/">scrollView</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sec/">sec</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/session/">session</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/setCompoundDrawables/">setCompoundDrawables</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shutdown/">shutdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/so/">so</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlite/">sqlite</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/startActivityForResult/">startActivityForResult</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/static/">static</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swift/">swift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/thread/">thread</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uml/">uml</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/usagestats/">usagestats</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/volatile/">volatile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/workflow/">workflow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xcode/">xcode</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://wangrong.xyz/">WR</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">我们走在大路上</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">大路</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">大路</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="Mailto:dalufine@163.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/dalufine" title="GitHub"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-java-Process" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/01/17/java-Process/" class="article-date">
      <time datetime="2015-01-17T10:44:12.000Z" itemprop="datePublished">2015-01-17</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      java.lang.Process 阻塞问题 &amp; Runtime.exec()的陷阱
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/java/">java</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/process/">process</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>When <code>Runtime.exec()</code> won’t<br>Navigate yourself around pitfalls related to the Runtime.exec() method</p>
<blockquote>
<p>Summary<br>In this installment of Java Traps, Michael Daconta discusses one new pitfall and revisits another from his previous column. Originating in the java.lang package, the pitfall specifically involves problems with the Runtime.exec() method. Daconta also corrects an error from Pitfall 3 and offers a simpler solution. (2,500 words)</p>
</blockquote>
<p>As part of the Java language, the <code>java.lang</code> package is implicitly imported into every Java program. This package’s pitfalls surface often, affecting most programmers. This month, I’ll discuss the traps lurking in the <code>Runtime.exec()</code> method.</p>
<a id="more"></a> 
<h3 id="Pitfall-4-When-Runtime-exec-won’t"><a href="#Pitfall-4-When-Runtime-exec-won’t" class="headerlink" title="Pitfall 4: When Runtime.exec() won’t"></a>Pitfall 4: When Runtime.exec() won’t</h3><p>The class <code>java.lang.Runtime</code> features a static method called <code>getRuntime()</code>, which retrieves the current Java Runtime Environment. That is the only way to obtain a reference to the <code>Runtime</code> object. With that reference, you can run external programs by invoking the <code>Runtime</code> class’s <code>exec()</code> method. Developers often call this method to launch a browser for displaying a help page in HTML.</p>
<p>There are four overloaded versions of the <code>exec()</code> command:</p>
<pre><code>public Process exec(String command);
public Process exec(String [] cmdArray);
public Process exec(String command, String [] envp);
public Process exec(String [] cmdArray, String [] envp);
</code></pre><p>For each of these methods, a command – and possibly a set of arguments – is passed to an operating-system-specific function call. This subsequently creates an operating-system-specific process (a running program) with a reference to a <code>Process</code> class returned to the Java VM. The <code>Process</code> class is an abstract class, because a specific subclass of <code>Process</code> exists for each operating system.</p>
<p>You can pass three possible input parameters into these methods:</p>
<ol>
<li>A single string that represents both the program to execute and any arguments to that program.</li>
<li>An array of strings that separate the program from its arguments.</li>
<li>An array of environment variables</li>
</ol>
<p>Pass in the environment variables in the form <code>name=value.</code> If you use the version of <code>exec()</code> with a single string for both the program and its arguments, note that the string is parsed using white space as the delimiter via the <code>StringTokenizer</code> class.</p>
<h4 id="Stumbling-into-an-IllegalThreadStateException"><a href="#Stumbling-into-an-IllegalThreadStateException" class="headerlink" title="Stumbling into an IllegalThreadStateException"></a>Stumbling into an IllegalThreadStateException</h4><p>The first pitfall(陷阱) relating to <code>Runtime.exec()</code> is the <code>IllegalThreadStateException</code>. The prevalent first test of an API is to code its most obvious methods. For example, to execute a process that is external to the Java VM, we use the <code>exec()</code> method. To see the value that the external process returns, we use the <code>exitValue()</code> method on the Process class. In our first example, we will attempt to execute the Java compiler (javac.exe):</p>
<p><strong>Listing 4.1</strong> <em>BadExecJavac.java</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.*;</div><div class="line"><span class="keyword">import</span> java.io.*;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BadExecJavac</span></span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">try</span></div><div class="line">        &#123;            </div><div class="line">            Runtime rt = Runtime.getRuntime();</div><div class="line">            Process proc = rt.exec(<span class="string">"javac"</span>);</div><div class="line">            <span class="keyword">int</span> exitVal = proc.exitValue();</div><div class="line">            System.out.println(<span class="string">"Process exitValue: "</span> + exitVal);</div><div class="line">        &#125; <span class="keyword">catch</span> (Throwable t)</div><div class="line">          &#123;</div><div class="line">            t.printStackTrace();</div><div class="line">          &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>A run of BadExecJavac produces:</p>
<pre><code>E:/classes/com/javaworld/jpitfalls/article2&gt;java BadExecJavac
java.lang.IllegalThreadStateException: process has not exited
        at java.lang.Win32Process.exitValue(Native Method)
        at BadExecJavac.main(BadExecJavac.java:13)
</code></pre><p>If an external process has not yet completed, the <code>exitValue()</code> method will throw an <code>IllegalThreadStateException</code>; that’s why this program failed. While the documentation states this fact, why can’t this method wait until it can give a valid answer?</p>
<p>A more thorough look at the methods available in the Process class reveals a <code>waitFor()</code> method that does precisely that. In fact, <code>waitFor()</code> also returns the exit value, which means that you would not use exitValue() and waitFor() in conjunction(联合) with each other, but rather would choose one or the other. The only possible time you would use <code>exitValue()</code> instead of waitFor() would be when you don’t want your program to block waiting on an external process that may never complete. Instead of using the waitFor() method, I would prefer passing a boolean parameter called waitFor into the exitValue() method to determine whether or not the current thread should wait. A boolean would be more beneficial because exitValue() is a more appropriate name for this method, and it isn’t necessary for two methods to perform the same function under different conditions. Such simple condition discrimination is the domain of an input parameter.</p>
<p>Therefore, to avoid this trap, either catch the <code>IllegalThreadStateException</code> or wait for the process to complete.</p>
<p>Now, let’s fix the problem in Listing 4.1 and wait for the process to complete. In Listing 4.2, the program again attempts to execute javac.exe and then waits for the external process to complete:</p>
<p><strong>Listing 4.2</strong>  <em>BadExecJavac2.java</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.*;</div><div class="line"><span class="keyword">import</span> java.io.*;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BadExecJavac2</span></span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">try</span></div><div class="line">        &#123;            </div><div class="line">            Runtime rt = Runtime.getRuntime();</div><div class="line">            Process proc = rt.exec(<span class="string">"javac"</span>);</div><div class="line">            <span class="keyword">int</span> exitVal = proc.waitFor();</div><div class="line">            System.out.println(<span class="string">"Process exitValue: "</span> + exitVal);</div><div class="line">        &#125; <span class="keyword">catch</span> (Throwable t)</div><div class="line">          &#123;</div><div class="line">            t.printStackTrace();</div><div class="line">          &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Unfortunately, a run of BadExecJavac2 produces no output. The program hangs and never completes. Why does the javacprocess never complete?</p>
<h4 id="Why-Runtime-exec-hangs"><a href="#Why-Runtime-exec-hangs" class="headerlink" title="Why Runtime.exec() hangs"></a>Why Runtime.exec() hangs</h4><p>The JDK’s Javadoc documentation provides the answer to this question:</p>
<blockquote>
<p>Because some native platforms only provide limited buffer size for standard input and output streams, failure to promptly write the input stream or read the output stream of the subprocess may cause the subprocess to block, and even deadlock.</p>
</blockquote>
<p>Is this just a case of programmers not reading the documentation, as implied in the oft-quoted advice: read the fine manual (RTFM)? The answer is partially yes. In this case, reading the Javadoc would get you halfway there; it explains that you need to handle the streams to your external process, but it does not tell you how.(少年，今天你看文档了吗？)</p>
<p>Another variable is at play here, as is evident by the large number of programmer questions and misconceptions concerning this API in the newsgroups: though <code>Runtime.exec()</code> and the Process APIs seem extremely simple, that simplicity is deceiving because the simple, or obvious, use of the API is prone to error. The lesson here for the API designer is to reserve simple APIs for simple operations. Operations prone to complexities and platform-specific dependencies should reflect the domain accurately. It is possible for an abstraction to be carried too far. The JConfiglibrary provides an example of a more complete API to handle file and process operations .</p>
<p>Now, let’s follow the JDK documentation and handle the output of the javac process. When you run javac without any arguments, it produces a set of usage statements that describe how to run the program and the meaning of all the available program options. Knowing that this is going to the stderr stream, you can easily write a program to exhaust that stream before waiting for the process to exit. Listing 4.3 completes that task. While this approach will work, it is not a good general solution. Thus, Listing 4.3’s program is named <code>MediocreExecJavac</code>; it provides only a mediocre solution. A better solution would empty both the standard error stream and the standard output stream. And the best solution would empty these streams simultaneously (I’ll demonstrate that later).</p>
<p><strong>Listing 4.3</strong>  <em>MediocreExecJavac.java</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.*;</div><div class="line"><span class="keyword">import</span> java.io.*;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MediocreExecJavac</span></span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">try</span></div><div class="line">        &#123;            </div><div class="line">            Runtime rt = Runtime.getRuntime();</div><div class="line">            Process proc = rt.exec(<span class="string">"javac"</span>);</div><div class="line">            InputStream stderr = proc.getErrorStream();</div><div class="line">            InputStreamReader isr = <span class="keyword">new</span> InputStreamReader(stderr);</div><div class="line">            BufferedReader br = <span class="keyword">new</span> BufferedReader(isr);</div><div class="line">            String line = <span class="keyword">null</span>;</div><div class="line">            System.out.println(<span class="string">"&lt;ERROR&gt;"</span>);</div><div class="line">            <span class="keyword">while</span> ( (line = br.readLine()) != <span class="keyword">null</span>)</div><div class="line">                System.out.println(line);</div><div class="line">            System.out.println(<span class="string">"&lt;/ERROR&gt;"</span>);</div><div class="line">            <span class="keyword">int</span> exitVal = proc.waitFor();</div><div class="line">            System.out.println(<span class="string">"Process exitValue: "</span> + exitVal);</div><div class="line">        &#125; <span class="keyword">catch</span> (Throwable t)</div><div class="line">          &#123;</div><div class="line">            t.printStackTrace();</div><div class="line">          &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>A run of MediocreExecJavac generates:</p>
<pre><code>E:/classes/com/javaworld/jpitfalls/article2&gt;java MediocreExecJavac
&lt;ERROR&gt;
Usage: javac &lt;options&gt; &lt;source files&gt;
where &lt;options&gt; includes:
  -g                     Generate all debugging info
  -g:none                Generate no debugging info
  -g:{lines,vars,source} Generate only some debugging info
  -O                     Optimize; may hinder debugging or enlarge class files
  -nowarn                Generate no warnings
  -verbose               Output messages about what the compiler is doing
  -deprecation           Output source locations where deprecated APIs are used
  -classpath &lt;path&gt;      Specify where to find user class files
  -sourcepath &lt;path&gt;     Specify where to find input source files
  -bootclasspath &lt;path&gt;  Override location of bootstrap class files
  -extdirs &lt;dirs&gt;        Override location of installed extensions
  -d &lt;directory&gt;         Specify where to place generated class files
  -encoding &lt;encoding&gt;   Specify character encoding used by source files
  -target &lt;release&gt;      Generate class files for specific VM version
&lt;/ERROR&gt;
Process exitValue: 2
</code></pre><p>So, <code>MediocreExecJavac</code> works and produces an exit value of 2. Normally, an exit value of <code>0 indicates success</code>; any <code>nonzero value indicates an error</code>. The meaning of these exit values depends on the particular operating system. A Win32 error with a value of 2 is a “file not found” error. That makes sense, since javac expects us to follow the program with the source code file to compile.</p>
<p>Thus, to circumvent the second pitfall – hanging forever in Runtime.exec() – if the program you launch produces output or expects input, ensure that you process the input and output streams.</p>
<h4 id="Assuming-a-command-is-an-executable-program"><a href="#Assuming-a-command-is-an-executable-program" class="headerlink" title="Assuming a command is an executable program"></a>Assuming a command is an executable program</h4><p>Under the Windows operating system, many new programmers stumble upon Runtime.exec() when trying to use it for nonexecutable commands like dir and copy. Subsequently, they run into Runtime.exec()’s third pitfall. Listing 4.4 demonstrates exactly that:</p>
<p><strong>Listing 4.4</strong>  <em>BadExecWinDir.java</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.*;</div><div class="line"><span class="keyword">import</span> java.io.*;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BadExecWinDir</span></span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">try</span></div><div class="line">        &#123;            </div><div class="line">            Runtime rt = Runtime.getRuntime();</div><div class="line">            Process proc = rt.exec(<span class="string">"dir"</span>);</div><div class="line">            InputStream stdin = proc.getInputStream();</div><div class="line">            InputStreamReader isr = <span class="keyword">new</span> InputStreamReader(stdin);</div><div class="line">            BufferedReader br = <span class="keyword">new</span> BufferedReader(isr);</div><div class="line">            String line = <span class="keyword">null</span>;</div><div class="line">            System.out.println(<span class="string">"&lt;OUTPUT&gt;"</span>);</div><div class="line">            <span class="keyword">while</span> ( (line = br.readLine()) != <span class="keyword">null</span>)</div><div class="line">                System.out.println(line);</div><div class="line">            System.out.println(<span class="string">"&lt;/OUTPUT&gt;"</span>);</div><div class="line">            <span class="keyword">int</span> exitVal = proc.waitFor();            </div><div class="line">            System.out.println(<span class="string">"Process exitValue: "</span> + exitVal);</div><div class="line">        &#125; <span class="keyword">catch</span> (Throwable t)</div><div class="line">          &#123;</div><div class="line">            t.printStackTrace();</div><div class="line">          &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>A run of BadExecWinDir produces:</p>
<pre><code>E:/classes/com/javaworld/jpitfalls/article2&gt;java BadExecWinDir
java.io.IOException: CreateProcess: dir error=2
    at java.lang.Win32Process.create(Native Method)
    at java.lang.Win32Process.&lt;init&gt;(Unknown Source)
    at java.lang.Runtime.execInternal(Native Method)
    at java.lang.Runtime.exec(Unknown Source)
    at java.lang.Runtime.exec(Unknown Source)
    at java.lang.Runtime.exec(Unknown Source)
    at java.lang.Runtime.exec(Unknown Source)
    at BadExecWinDir.main(BadExecWinDir.java:12)
</code></pre><p>As stated earlier, the error value of 2 means “file not found,” which, in this case, means that the executable nameddir.exe could not be found. That’s because the directory command is part of the Windows command interpreter and not a separate executable. To run the Windows command interpreter, execute either command.com or cmd.exe, depending on the Windows operating system you use. Listing 4.5 runs a copy of the Windows command interpreter and then executes the user-supplied command (e.g., dir).</p>
<p><strong>Listing 4.5</strong>  <em>GoodWindowsExec.java</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.*;</div><div class="line"><span class="keyword">import</span> java.io.*;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">StreamGobbler</span> <span class="keyword">extends</span> <span class="title">Thread</span></span></div><div class="line">&#123;</div><div class="line">    InputStream is;</div><div class="line">    String type;</div><div class="line">    </div><div class="line">    StreamGobbler(InputStream is, String type)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">this</span>.is = is;</div><div class="line">        <span class="keyword">this</span>.type = type;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">try</span></div><div class="line">        &#123;</div><div class="line">            InputStreamReader isr = <span class="keyword">new</span> InputStreamReader(is);</div><div class="line">            BufferedReader br = <span class="keyword">new</span> BufferedReader(isr);</div><div class="line">            String line=<span class="keyword">null</span>;</div><div class="line">            <span class="keyword">while</span> ( (line = br.readLine()) != <span class="keyword">null</span>)</div><div class="line">                System.out.println(type + <span class="string">"&gt;"</span> + line);    </div><div class="line">            &#125; <span class="keyword">catch</span> (IOException ioe)</div><div class="line">              &#123;</div><div class="line">                ioe.printStackTrace();  </div><div class="line">              &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodWindowsExec</span></span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (args.length &lt; <span class="number">1</span>)</div><div class="line">        &#123;</div><div class="line">            System.out.println(<span class="string">"USAGE: java GoodWindowsExec &lt;cmd&gt;"</span>);</div><div class="line">            System.exit(<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">try</span></div><div class="line">        &#123;            </div><div class="line">            String osName = System.getProperty(<span class="string">"os.name"</span> );</div><div class="line">            String[] cmd = <span class="keyword">new</span> String[<span class="number">3</span>];</div><div class="line"></div><div class="line">            <span class="keyword">if</span>( osName.equals( <span class="string">"Windows NT"</span> ) )</div><div class="line">            &#123;</div><div class="line">                cmd[<span class="number">0</span>] = <span class="string">"cmd.exe"</span> ;</div><div class="line">                cmd[<span class="number">1</span>] = <span class="string">"/C"</span> ;</div><div class="line">                cmd[<span class="number">2</span>] = args[<span class="number">0</span>];</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span>( osName.equals( <span class="string">"Windows 95"</span> ) )</div><div class="line">            &#123;</div><div class="line">                cmd[<span class="number">0</span>] = <span class="string">"command.com"</span> ;</div><div class="line">                cmd[<span class="number">1</span>] = <span class="string">"/C"</span> ;</div><div class="line">                cmd[<span class="number">2</span>] = args[<span class="number">0</span>];</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            Runtime rt = Runtime.getRuntime();</div><div class="line">            System.out.println(<span class="string">"Execing "</span> + cmd[<span class="number">0</span>] + <span class="string">" "</span> + cmd[<span class="number">1</span>] </div><div class="line">                               + <span class="string">" "</span> + cmd[<span class="number">2</span>]);</div><div class="line">            Process proc = rt.exec(cmd);</div><div class="line">            <span class="comment">// any error message?</span></div><div class="line">            StreamGobbler errorGobbler = <span class="keyword">new</span> </div><div class="line">                StreamGobbler(proc.getErrorStream(), <span class="string">"ERROR"</span>);            </div><div class="line">            </div><div class="line">            <span class="comment">// any output?</span></div><div class="line">            StreamGobbler outputGobbler = <span class="keyword">new</span> </div><div class="line">                StreamGobbler(proc.getInputStream(), <span class="string">"OUTPUT"</span>);</div><div class="line">                </div><div class="line">            <span class="comment">// kick them off</span></div><div class="line">            errorGobbler.start();</div><div class="line">            outputGobbler.start();</div><div class="line">                                    </div><div class="line">            <span class="comment">// any error???</span></div><div class="line">            <span class="keyword">int</span> exitVal = proc.waitFor();</div><div class="line">            System.out.println(<span class="string">"ExitValue: "</span> + exitVal);        </div><div class="line">        &#125; <span class="keyword">catch</span> (Throwable t)</div><div class="line">          &#123;</div><div class="line">            t.printStackTrace();</div><div class="line">          &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Running GoodWindowsExec with the dir command generates:</p>
<pre><code>E:/classes/com/javaworld/jpitfalls/article2&gt;java GoodWindowsExec &quot;dir *.java&quot;
Execing cmd.exe /C dir *.java
OUTPUT&gt; Volume in drive E has no label.
OUTPUT&gt; Volume Serial Number is 5C5F-0CC9
OUTPUT&gt;
OUTPUT&gt; Directory of E:/classes/com/javaworld/jpitfalls/article2
OUTPUT&gt;
OUTPUT&gt;10/23/00  09:01p                   805 BadExecBrowser.java
OUTPUT&gt;10/22/00  09:35a                   770 BadExecBrowser1.java
OUTPUT&gt;10/24/00  08:45p                   488 BadExecJavac.java
OUTPUT&gt;10/24/00  08:46p                   519 BadExecJavac2.java
OUTPUT&gt;10/24/00  09:13p                   930 BadExecWinDir.java
OUTPUT&gt;10/22/00  09:21a                 2,282 BadURLPost.java
OUTPUT&gt;10/22/00  09:20a                 2,273 BadURLPost1.java
... (some output omitted for brevity)
OUTPUT&gt;10/12/00  09:29p                   151 SuperFrame.java
OUTPUT&gt;10/24/00  09:23p                 1,814 TestExec.java
OUTPUT&gt;10/09/00  05:47p                23,543 TestStringReplace.java
OUTPUT&gt;10/12/00  08:55p                   228 TopLevel.java
OUTPUT&gt;              22 File(s)         46,661 bytes
OUTPUT&gt;                         19,678,420,992 bytes free
ExitValue: 0
</code></pre><p>Running <code>GoodWindowsExec</code> with any associated document type will launch the application associated with that document type. For example, to launch Microsoft Word to display a Word document (i.e., one with a .doc extension), type:</p>
<pre><code>java GoodWindowsExec &quot;yourdoc.doc&quot;
</code></pre><p>Notice that <code>GoodWindowsExec</code> uses the <code>os.name</code> system property to determine which Windows operating system you are running – and thus determine the appropriate command interpreter. After executing the command interpreter, handle the standard error and standard input streams with the <code>StreamGobbler</code> class. StreamGobbler empties any stream passed into it in a separate thread. The class uses a simple String type to denote the stream it empties when it prints the line just read to the console.</p>
<p>Thus, to avoid the third pitfall related to <code>Runtime.exec()</code>, do not assume that a command is an executable program; know whether you are executing a standalone executable or an interpreted command. At the end of this section, I will demonstrate a simple command-line tool that will help you with that analysis.</p>
<p>It is important to note that the method used to obtain a process’s output stream is called getInputStream(). The thing to remember is that the API sees things from the perspective(角度) of the Java program and not the external process. Therefore, the external program’s output is the Java program’s input. And that logic carries over to the external program’s input stream, which is an output stream to the Java program.</p>
<h4 id="Runtime-exec-is-not-a-command-line"><a href="#Runtime-exec-is-not-a-command-line" class="headerlink" title="Runtime.exec() is not a command line"></a>Runtime.exec() is not a command line</h4><p>One final pitfall to cover with <code>Runtime.exec()</code> is mistakenly assuming that exec() accepts any String that your command line (or shell) accepts. Runtime.exec() is much more limited and not cross-platform. This pitfall is caused by users attempting to use the exec() method to accept a single String as a command line would. The confusion may be due to the fact that <code>command</code> is the parameter name for the exec() method. Thus, the programmer incorrectly associates the parameter command with anything that he or she can type on a command line, instead of associating it with a single program and its arguments. In listing 4.6 below, a user tries to execute a command and redirect its output in one call to exec():</p>
<p><strong>Listing 4.6</strong>  <em>BadWinRedirect.java</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.*;</div><div class="line"><span class="keyword">import</span> java.io.*;</div><div class="line"></div><div class="line"><span class="comment">// StreamGobbler omitted for brevity</span></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BadWinRedirect</span></span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">try</span></div><div class="line">        &#123;            </div><div class="line">            Runtime rt = Runtime.getRuntime();</div><div class="line">            Process proc = rt.exec(<span class="string">"java jecho 'Hello World' &gt; test.txt"</span>);</div><div class="line">            <span class="comment">// any error message?</span></div><div class="line">            StreamGobbler errorGobbler = <span class="keyword">new</span> </div><div class="line">                StreamGobbler(proc.getErrorStream(), <span class="string">"ERROR"</span>);            </div><div class="line">            </div><div class="line">            <span class="comment">// any output?</span></div><div class="line">            StreamGobbler outputGobbler = <span class="keyword">new</span> </div><div class="line">                StreamGobbler(proc.getInputStream(), <span class="string">"OUTPUT"</span>);</div><div class="line">                </div><div class="line">            <span class="comment">// kick them off</span></div><div class="line">            errorGobbler.start();</div><div class="line">            outputGobbler.start();</div><div class="line">                                    </div><div class="line">            <span class="comment">// any error???</span></div><div class="line">            <span class="keyword">int</span> exitVal = proc.waitFor();</div><div class="line">            System.out.println(<span class="string">"ExitValue: "</span> + exitVal);        </div><div class="line">        &#125; <span class="keyword">catch</span> (Throwable t)</div><div class="line">          &#123;</div><div class="line">            t.printStackTrace();</div><div class="line">          &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Running BadWinRedirect produces:</p>
<pre><code>E:/classes/com/javaworld/jpitfalls/article2&gt;java BadWinRedirect
OUTPUT&gt;&apos;Hello World&apos; &gt; test.txt
ExitValue: 0
</code></pre><p>The program <code>BadWinRedirect</code> attempted to redirect the output of an echo program’s simple Java version into the filetest.txt. However, we find that the file test.txt does not exist. The <code>jecho</code> program simply takes its command-line arguments and writes them to the standard output stream. In Listing 4.6, the user assumed that you could redirect standard output into a file just as you could on a DOS command line. Nevertheless, you do not redirect the output through this approach. The incorrect assumption here is that the exec() method acts like a shell interpreter; it does not. Instead, exec()executes a single executable (a program or script). If you want to process the stream to either redirect it or pipe it into another program, you must do so programmatically, using the java.io package. Listing 4.7 properly redirects the standard output stream of the jecho process into a file.</p>
<p><strong>Listing 4.7</strong>  <em>GoodWinRedirect.java</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.*;</div><div class="line"><span class="keyword">import</span> java.io.*;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">StreamGobbler</span> <span class="keyword">extends</span> <span class="title">Thread</span></span></div><div class="line">&#123;</div><div class="line">    InputStream is;</div><div class="line">    String type;</div><div class="line">    OutputStream os;</div><div class="line">    </div><div class="line">    StreamGobbler(InputStream is, String type)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">this</span>(is, type, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    StreamGobbler(InputStream is, String type, OutputStream redirect)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">this</span>.is = is;</div><div class="line">        <span class="keyword">this</span>.type = type;</div><div class="line">        <span class="keyword">this</span>.os = redirect;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">try</span></div><div class="line">        &#123;</div><div class="line">            PrintWriter pw = <span class="keyword">null</span>;</div><div class="line">            <span class="keyword">if</span> (os != <span class="keyword">null</span>)</div><div class="line">                pw = <span class="keyword">new</span> PrintWriter(os);</div><div class="line">                </div><div class="line">            InputStreamReader isr = <span class="keyword">new</span> InputStreamReader(is);</div><div class="line">            BufferedReader br = <span class="keyword">new</span> BufferedReader(isr);</div><div class="line">            String line=<span class="keyword">null</span>;</div><div class="line">            <span class="keyword">while</span> ( (line = br.readLine()) != <span class="keyword">null</span>)</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">if</span> (pw != <span class="keyword">null</span>)</div><div class="line">                    pw.println(line);</div><div class="line">                System.out.println(type + <span class="string">"&gt;"</span> + line);    </div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (pw != <span class="keyword">null</span>)</div><div class="line">                pw.flush();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException ioe)</div><div class="line">            &#123;</div><div class="line">            ioe.printStackTrace();  </div><div class="line">            &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodWinRedirect</span></span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (args.length &lt; <span class="number">1</span>)</div><div class="line">        &#123;</div><div class="line">            System.out.println(<span class="string">"USAGE java GoodWinRedirect &lt;outputfile&gt;"</span>);</div><div class="line">            System.exit(<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">try</span></div><div class="line">        &#123;            </div><div class="line">            FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(args[<span class="number">0</span>]);</div><div class="line">            Runtime rt = Runtime.getRuntime();</div><div class="line">            Process proc = rt.exec(<span class="string">"java jecho 'Hello World'"</span>);</div><div class="line">            <span class="comment">// any error message?</span></div><div class="line">            StreamGobbler errorGobbler = <span class="keyword">new</span> </div><div class="line">                StreamGobbler(proc.getErrorStream(), <span class="string">"ERROR"</span>);            </div><div class="line">            </div><div class="line">            <span class="comment">// any output?</span></div><div class="line">            StreamGobbler outputGobbler = <span class="keyword">new</span> </div><div class="line">                StreamGobbler(proc.getInputStream(), <span class="string">"OUTPUT"</span>, fos);</div><div class="line">                </div><div class="line">            <span class="comment">// kick them off</span></div><div class="line">            errorGobbler.start();</div><div class="line">            outputGobbler.start();</div><div class="line">                                    </div><div class="line">            <span class="comment">// any error???</span></div><div class="line">            <span class="keyword">int</span> exitVal = proc.waitFor();</div><div class="line">            System.out.println(<span class="string">"ExitValue: "</span> + exitVal);</div><div class="line">            fos.flush();</div><div class="line">            fos.close();        </div><div class="line">        &#125; <span class="keyword">catch</span> (Throwable t)</div><div class="line">          &#123;</div><div class="line">            t.printStackTrace();</div><div class="line">          &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Running GoodWinRedirect produces:</p>
<pre><code>E:/classes/com/javaworld/jpitfalls/article2&gt;java GoodWinRedirect test.txt
OUTPUT&gt;&apos;Hello World&apos;
ExitValue: 0
</code></pre><p>After running <code>GoodWinRedirect</code>, test.txt does exist. The solution to the pitfall was to simply control the redirection by handling the external process’s standard output stream separately(分离) from the Runtime.exec() method. We create a separate OutputStream, read in the filename to which we redirect the output, open the file, and write the output that we receive from the spawned process’s standard output to the file. Listing 4.7 completes that task by adding a new constructor to our <code>StreamGobbler</code> class. The new constructor takes three arguments: the input stream to gobble, the type String that labels the stream we are gobbling, and the output stream to which we redirect the input. This new version of StreamGobbler does not break any of the code in which it was previously used, as we have not changed the existing public API – we only extended it.</p>
<p>Since the argument to Runtime.exec() is dependent on the operating system, the proper commands to use will vary from one OS to another. So, before finalizing arguments to Runtime.exec() and writing the code, quickly test the arguments. Listing 4.8 is a simple command-line utility that allows you to do just that.</p>
<p>Here’s a useful exercise: try to modify TestExec to redirect the standard input or standard output to a file. When executing the javac compiler on Windows 95 or Windows 98, that would solve the problem of error messages scrolling off the top of the limited command-line buffer.</p>
<p><strong>Listing 4.8</strong>  <em>TestExec.java</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.*;</div><div class="line"><span class="keyword">import</span> java.io.*;</div><div class="line"></div><div class="line"><span class="comment">// class StreamGobbler omitted for brevity</span></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestExec</span></span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (args.length &lt; <span class="number">1</span>)</div><div class="line">        &#123;</div><div class="line">            System.out.println(<span class="string">"USAGE: java TestExec /"</span>cmd/<span class="string">""</span>);</div><div class="line">            System.exit(<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">try</span></div><div class="line">        &#123;</div><div class="line">            String cmd = args[<span class="number">0</span>];</div><div class="line">            Runtime rt = Runtime.getRuntime();</div><div class="line">            Process proc = rt.exec(cmd);</div><div class="line">            </div><div class="line">            <span class="comment">// any error message?</span></div><div class="line">            StreamGobbler errorGobbler = <span class="keyword">new</span> </div><div class="line">                StreamGobbler(proc.getErrorStream(), <span class="string">"ERR"</span>);            </div><div class="line">            </div><div class="line">            <span class="comment">// any output?</span></div><div class="line">            StreamGobbler outputGobbler = <span class="keyword">new</span> </div><div class="line">                StreamGobbler(proc.getInputStream(), <span class="string">"OUT"</span>);</div><div class="line">                </div><div class="line">            <span class="comment">// kick them off</span></div><div class="line">            errorGobbler.start();</div><div class="line">            outputGobbler.start();</div><div class="line">                                    </div><div class="line">            <span class="comment">// any error???</span></div><div class="line">            <span class="keyword">int</span> exitVal = proc.waitFor();</div><div class="line">            System.out.println(<span class="string">"ExitValue: "</span> + exitVal);</div><div class="line">        &#125; <span class="keyword">catch</span> (Throwable t)</div><div class="line">          &#123;</div><div class="line">            t.printStackTrace();</div><div class="line">          &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Running TestExec to launch the Netscape browser and load the Java help documentation produces:</p>
<pre><code>E:/classes/com/javaworld/jpitfalls/article2&gt;java TestExec &quot;e:/java/docs/index.html&quot;
java.io.IOException: CreateProcess: e:/java/docs/index.html error=193
        at java.lang.Win32Process.create(Native Method)
        at java.lang.Win32Process.&lt;init&gt;(Unknown Source)
        at java.lang.Runtime.execInternal(Native Method)
        at java.lang.Runtime.exec(Unknown Source)
        at java.lang.Runtime.exec(Unknown Source)
        at java.lang.Runtime.exec(Unknown Source)
        at java.lang.Runtime.exec(Unknown Source)
        at TestExec.main(TestExec.java:45)
</code></pre><p>Our first test failed with an error of 193. The Win32 error for value 193 is “not a valid Win32 application.” This error tells us that no path to an associated application (e.g., Netscape) exists, and that the process cannot run an HTML file without an associated application.</p>
<p>Therefore, we try the test again, this time giving it a full path to Netscape. (Alternately, we could add Netscape to our PATH environment variable.) A second run of TestExec produces:</p>
<pre><code>E:/classes/com/javaworld/jpitfalls/article2&gt;java TestExec 
&quot;e:/program files/netscape/program/netscape.exe e:/java/docs/index.html&quot;
ExitValue: 0
</code></pre><p>This worked! The Netscape browser launches, and it then loads the Java help documentation.</p>
<p>One additional improvement to TestExec would include a command-line switch to accept input from standard input. You would then use the Process.getOutputStream() method to pass the input to the spawned external program.</p>
<p>To sum up, follow these rules of thumb to avoid the pitfalls in Runtime.exec():</p>
<ol>
<li>You cannot obtain an exit status from an external process until it has exited</li>
<li>You must immediately handle the input, output, and error streams from your spawned external process</li>
<li>You must use Runtime.exec() to execute programs</li>
<li>You cannot use Runtime.exec() like a command line</li>
</ol>
<h4 id="Correction-to-Pitfall-3"><a href="#Correction-to-Pitfall-3" class="headerlink" title="Correction to Pitfall 3"></a>Correction to Pitfall 3</h4><p>In the discussion of Pitfall 3 (“Don’t mix floats and doubles when generating text or XML messages”) in my last column, I incorrectly stated that the different string representation of a decimal number after casting it from a float to a double was a bug. While this is a pitfall, its cause is not a bug, but the fact that the decimal numbers in question – 100.28 and 91.09 – do not represent precisely in binary.</p>
<p>The combination of forgetting my numerical methods class, the numerous bug reports on the bug parade, and the automatic rounding of floats and doubles when printing (but not after casting a float to a double) threw me. I apologize for confusing anyone who read the article, especially to new Java programmers. I present two better solutions to the problem:</p>
<p>The first possible solution is to always specify the desired rounding explicitly with <code>NumberFormat</code>. In my case, I use the float and double to represent dollars and cents; therefore, I need only two significant digits. Listing C3.1 demonstrates how to use the <code>NumberFormat</code> class to specify a maximum of two fraction digits.</p>
<p><strong>Listing C3.1</strong>  <em>FormatNumbers.java</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.text.*;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FormatNumbers</span></span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">try</span></div><div class="line">        &#123;</div><div class="line">            NumberFormat fmt = NumberFormat.getInstance();</div><div class="line">            fmt.setMaximumFractionDigits(<span class="number">2</span>);</div><div class="line">            <span class="keyword">float</span> f = <span class="number">100.28f</span>;</div><div class="line">            System.out.println(<span class="string">"As a float        : "</span> + f);</div><div class="line">            <span class="keyword">double</span> d = f;</div><div class="line">            System.out.println(<span class="string">"Cast to a double  : "</span> + d);</div><div class="line">            System.out.println(<span class="string">"Using NumberFormat: "</span> + fmt.format(d));            </div><div class="line">        &#125; <span class="keyword">catch</span> (Throwable t)</div><div class="line">          &#123;</div><div class="line">            t.printStackTrace();</div><div class="line">          &#125;          </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>When we run the FormatNumbers program, it produces:</p>
<pre><code>E:/classes/com/javaworld/jpitfalls/article2&gt;java FormatNumbers
As a float        : 100.28
Cast to a double  : 100.27999877929688
Using NumberFormat: 100.28
</code></pre><p>As you can see – regardless of whether we cast the float to a double – when we specify the number of digits we want, it properly rounds to that precision – even if the number is infinitely repeating in binary. To circumvent this pitfall, control the formatting of your doubles and floats when converting to a String.</p>
<p>A second, simpler solution would be to not use a float to represent cents. Integers (number of pennies) can represent cents, with a legal range of 0 to 99. You can check the range in the mutator method.</p>
<hr>
<p>参考链接：<a href="http://kingj.iteye.com/blog/1420586" target="_blank" rel="external">方案一</a>，<a href="http://blog.csdn.net/aerchi/article/details/7653372" target="_blank" rel="external">方案二</a></p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2015/01/17/java-Process/">java.lang.Process 阻塞问题 &amp; Runtime.exec()的陷阱</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">大路</a></p>
        <p><span>发布时间:</span>2015-01-17, 18:44:12</p>
        <p><span>最后更新:</span>2015-01-17, 18:44:12</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2015/01/17/java-Process/" title="java.lang.Process 阻塞问题 &amp; Runtime.exec()的陷阱">http://dalufan.com/2015/01/17/java-Process/</a>
            <span class="copy-path" data-clipboard-text="原文: http://dalufan.com/2015/01/17/java-Process/　　作者: 大路" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2015/02/11/android-thread-volatile-synchronized-final/">
                    进程通信中volatile, synchronized, final的使用
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2015/01/16/android-excel/">
                    android操作Excel文件
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Pitfall-4-When-Runtime-exec-won’t"><span class="toc-number">1.</span> <span class="toc-text">Pitfall 4: When Runtime.exec() won’t</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Stumbling-into-an-IllegalThreadStateException"><span class="toc-number">1.1.</span> <span class="toc-text">Stumbling into an IllegalThreadStateException</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Why-Runtime-exec-hangs"><span class="toc-number">1.2.</span> <span class="toc-text">Why Runtime.exec() hangs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Assuming-a-command-is-an-executable-program"><span class="toc-number">1.3.</span> <span class="toc-text">Assuming a command is an executable program</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Runtime-exec-is-not-a-command-line"><span class="toc-number">1.4.</span> <span class="toc-text">Runtime.exec() is not a command line</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Correction-to-Pitfall-3"><span class="toc-number">1.5.</span> <span class="toc-text">Correction to Pitfall 3</span></a></li></ol></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"java.lang.Process 阻塞问题 & Runtime.exec()的陷阱　| 道听途说　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    
      <div class="duoshuo" id="comments">
    <div id="comment-box" ></div>
    <div class="ds-thread" id="ds-thread" data-thread-key="2015/01/17/java-Process/" data-title="java.lang.Process 阻塞问题 &amp; Runtime.exec()的陷阱" data-url="http://dalufan.com/2015/01/17/java-Process/"></div>
    <script>
        var duoshuoQuery = {short_name:"dalufan"};
        var loadComment = function(){
            var d = document, s = d.createElement('script');
            s.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
            s.async = true; s.charset = 'UTF-8';
            (d.head || d.body).appendChild(s);
        }

        
    </script>
    
    <script> loadComment(); </script>

</div>
    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2015/02/11/android-thread-volatile-synchronized-final/" title="上一篇: 进程通信中volatile, synchronized, final的使用">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2015/01/16/android-excel/" title="下一篇: android操作Excel文件">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/11/16/gradle-learn/">Gradle的用法</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/07/android-startActivityForResult-FragmentActivity-Fragment/">彻底搞懂startActivityForResult在FragmentActivity和Fragment中的异同</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/03/android-dynamicicon-example/">android动态更新APP图标和label</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/28/android-ViewPager-Fragment-LazyLoad/">ViewPager+Fragment LazyLoad 最优解</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/08/java-singleton-good-write/">Java更好的单例写法</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/02/android-recycleview-useage-issues/">RecycleView的使用及坑</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/03/android-click-icon-restart/">防止App在后台运行，点击应用桌面图标重新启动</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/02/android-some-little-knowledge/">Android的一些开发细节</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/30/mysql-join-usage/">图解SQL的Join</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/26/swift-string-create-class/">Swift:通过字符串创建类对象  </a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/25/android-fragment-backpress/">Fragment监听返回键事件</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/08/ios-constraint-autolayout-autoresizing/">autolayout和autoresizing的使用注意事项</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/09/xcode-eclipse-key-xcodeKit/">xcode中快速删除拷贝一行，like eclipse</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/09/ios-imageNamed-imageWithContentsOfFile-diff/">imageNamed和imageWithContentsOfFile的使用和区别</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/07/android-rotate-imageview/">Android 自定义可旋转的ImageView</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/19/mysql-case-when-and-left-join-demo/">mysql中UNIQUE、判断、组合查找的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/27/android-fragment-state-saving-best-practices/">fragment状态保存最佳实践</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/21/android-valueanimator-in-diy-view/">ValueAnimator在自定义View中的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/03/mysql-base-usage-03/">《mysql 必知必会》读书笔记三（21-30）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/30/mysql-base-usage-02/">《mysql 必知必会》读书笔记二（13-20）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/28/mysql-base-usage-01/">《mysql 必知必会》读书笔记一（1-12）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/21/android-listview-usage/">android listview的一些技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/11/android-react-native-learn-day02/">react-native学习笔记二</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/26/android-react-native-learn-day01/">react-native学习笔记一</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/17/android-widget-imageview-1/">自定义ImageView系列第一版</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/26/web-maven-springmvc-start-learn/">使用maven配置springmvc的过程中遇到的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/23/java-uml-learn/">UML中的五种关系</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/17/android-art-of-android-deveopment-note-2/">《Android 开发艺术探索》读书笔记--第二章 IPC机制</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/13/effective-java-learn-note-10-01/">《Effective Java》读书笔记--第十章 并发（一）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/20/android-art-of-android-deveopment-note-12/">《Android 开发艺术探索》读书笔记--第十二章 Bitmap 第十五章 性能优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/11/thinking-of-getting-the-current-activity-in-android/">如何获取当前Activity</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/08/workflow-feature-branch-Pull-Request/">WorkFlow--功能分支工作流(Pull Requests)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/02/workflow-Pull-Request/">Pull Requests的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/20/android-art-of-android-deveopment-note-10/">《Android 开发艺术探索》读书笔记--第十章Android的消息机制</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/11/android-art-of-android-deveopment-note-4/">《Android 开发艺术探索》读书笔记--第四章 View的工作原理</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/08/workflow-centralized-git-rebase/">WorkFlow--集中式工作流(git rebase)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/03/android-activity-onActivityResult/">Activity中onActivityResult存在的坑</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/01/android-sec-AndroidManifest/">AndroidManifest Ambiguity方案原理及代码</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/22/android-webview-upload-file/">Webview中上传文件支持全解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/20/android-webview-issues/">Webview中的问题及解决</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/18/android-art-of-android-deveopment-note-3/">《Android 开发艺术探索》读书笔记--第三章View事件体系</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/02/java-JSONObject-Stub/">java工程中调用Android库出现“Stub!”错误</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/30/android-ScrollView-fill/">android中ScrollView不能被完全填充</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/30/android-TextView-show-scrollbar/">android TextView始终显示滚动条的方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/30/android-open-eventbus-usage/">android中EventBus的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/30/android-network-type/">Android判断用户的网络类型(2/3/4G、wifi)</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/30/android-optimization-thread-ThreadPoolExecutor/">android性能优化--使用线程池处理异步任务</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/26/android-View-LinearGradient/">android中使用LinearGradient实现文字闪烁的效果</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/24/android-Activity-launch-learn/">Activity启动过程全解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/23/android-DownloadManager-usage/">android中使用DownloadManager来下载</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/22/android-context-learn/">Android Context完全解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/21/android-reconstruction-achievement/">Android项目重构的整理-实现篇</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/21/android-reconstruction-view/">Android项目重构的整理-界面篇</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/21/android-reconstruction-architecture/">Android项目重构的整理-架构篇</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/20/android-error-UncaughtExceptionHandler/">android中处理崩溃的一般方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/20/android-webview-js-safe-message/">Webview与Js之间的另一种交互</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/18/android-mat-usage/">MAT的一般使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/17/android-gc-leak/">android 内存泄露以及GC的相关知识</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/12/android-onSaveInstanceState-learn/">Activity和Fragement中onSaveInstanceState()的使用详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/07/app-hearsay/">道听途说</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/20/android-error-cannot-create-handler-inside/">android运行提示java.lang.RuntimeException: Can't create handler inside thread that has not</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/20/android-view-issues/">android中view相关的问题及解决</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/18/android-dex-inject-learn/">android dex注入实现详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/17/android-canvas-draw/">android中canvas的一些属性和用法</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/11/android-onTouchEvent/">Android触摸事件的响应机制</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/10/free-mail-mailinator/">mailinator 免费邮箱的使用说明</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/08/android-setOnPageChangeListener/">ViewPager的setOnPageChangeListener方法详解 </a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/08/android-Activity-ActionBarActivity-AppCompatActivity/">android中关于Activity/ActionBarActivity/AppCompatActivity的区分与理解</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/07/android-BitmapFactory-OutOfMemoryError/">android BitmapFactory的OutOfMemoryError的解决方案 </a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/03/git-android-as/">在android Studio 和 Eclipse 的 git 插件操作'代码提交'以及'代码冲突' </a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/01/android-QR-changesize/">Zxing二维码扫描框大小修改</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/28/android-handler-gc/">Handler的内存泄露及解决方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/28/retrofit-usage/">Retrofit 中文文档</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/28/android-Scrollview-RelativeLayout/">ScrollView中RelativeLayout设置match_parent无法填充满屏幕</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/28/git-reset-soft-mixed-hard/">Difference between git reset soft, mixed and hard</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/27/android-so-usage/">关于android的.so文件你所需要知道的</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/26/android-EmailAutoCompleteTextView/">android 邮箱地址自动补全</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/24/android-setCompoundDrawables-setCompoundDrawablesWithIntrinsicBounds/">android setCompoundDrawables与setCompoundDrawablesWithIntrinsicBounds的区别</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/20/android-Drawable-usage/">android Drawable 那些不为人知的高效用法</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/29/hello-world/">Hexo的使用方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/10/eclipse-cannot-open-git-upload-pack/">eclipse git push和pull出错</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/01/android-listview-ontouchevent/">android中对GridView， ListView等滚动控件的Touch事件onInterceptTouchEvent，onTouchEvent理解</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/06/29/android-javascript-exchange/">Android与Javascript交互概要</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/21/android-performance-optimization-SparseArray/">android应用性能优化中使用SparseArray替代HashMap</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/12/java-regex-useage/">Java正则表达式的一般使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/05/android-motionevent/">MotionEvent中getX()、getRawX()等位置说明</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/04/26/android-service-download-singlethread/">android中Service断点下载-单线程</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/04/18/service-not-be-killed/">android保证Service不被杀掉的方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/04/12/android-Intent-PendingIntent/">android中Intent和PendingIntent的区别</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/04/10/android-AlarmManager/">android中AlarmManager的说明例子</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/03/30/android-handler-learn/">android中Handler的使用Tips</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/03/14/android-sqlite-err/">sqlite遇到的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/02/14/android-sqlite-learn/">sqlite的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/02/11/android-thread-volatile-synchronized-final/">进程通信中volatile, synchronized, final的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/01/17/java-Process/">java.lang.Process 阻塞问题 & Runtime.exec()的陷阱</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/01/16/android-excel/">android操作Excel文件</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/01/14/android-Smail-learn/">Smail语法</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/01/12/android-ContentObserver-learn/">android中ContentObserver类详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/01/12/android-BroadCast-Security/">android广播中的安全问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/12/30/android-app-usagestats/">android 获取各应用的运行时间</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/12/29/ubuntu-android-driver/">ubuntu下解决不能识别android设备</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/12/25/android-View-learn-three/">android中简单自定义view③</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/12/25/android-DownloadManager/">android DownloadManager广播事件：下载完成、通知栏点击事件</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/12/23/android-View-learn-one/">android中View的使用及解释①</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/12/23/android-View-learn-two/">android中View的使用及解释②</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/12/21/android-ContentProvider-learn/">android ContentProvider基本使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/12/21/android-Uri-learn/">android中Uri的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/12/20/android-mediaplayer-usage/">android MediaPlayer基本使用方式</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/11/30/net-get-post/">GET请求和POST请求的区别</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/11/28/android-sec-commonly/">android一些安全事项</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/11/27/android-Intent/">android中Intent使用详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/11/27/android-BroadcastReceiver/">android中BroadcastReceiver应用详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/11/26/android-Service/">android中Service的详细使用说明</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/11/26/android-activity-task/">android中Activity的task</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/11/25/android-activity-launchMode/">android中Activity的四种launchMode</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/11/18/android-permission/">android声明和使用权限</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/11/14/android-view-IllegalArgumentException/">View not attached to window manager</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/11/12/httpclient-learn-conclusion/">httpclient使用总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/11/10/android-MediaRecorder-stop-error/">android录音时stop出错</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/11/08/android-xutils-http-learn/">xutils中HttpUtils模块分析①</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/10/20/android-error/">android异常/错误集</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/09/30/java-Generics/">java中泛型Generics的说明</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/09/26/java-ThreadPoolExecutor/">android里面ThreadPoolExecutor的说明</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/09/24/java-volatile-static/">java中volatile和static的区别 </a></li><li class="post-list-item"><a class="post-list-link" href="/2014/09/21/java-shutdown/">线程池shutdown()方法和shutdownNow()区别</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/09/19/java-volatile/">java 里面volatile的说明</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/09/19/java-AtomicInteger/">java 里面AtomicInteger的说明</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/09/07/java-string-format/">java中string.format方法使用介绍</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/09/06/java-Serializable/">java 里面Serializable的说明</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/09/05/eclipse-git-merge/">eclipse中git解决冲突</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/09/04/java-enum-final/">java中枚举和常量定义的区别</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/09/03/java-enum/">java中enum的用法详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/05/17/git-api/">git常用命令及思维导图</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/03/25/java-trans/">java是传值还是传引用</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/03/25/session-cookie/">详解COOKIE与SESSION的区别</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/02/16/string-stringbuffer/">String和StringBuffer的区别</a></li><li class="post-list-item"><a class="post-list-link" href="/2013/08/24/java-reflection/">Java反射Demo</a></li><li class="post-list-item"><a class="post-list-link" href="/2013/05/17/ubuntu_order/">ubuntu命令学习记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2013/05/17/sublime-text-2/">Sublime Text 2使用简介</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2013-2017 大路
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >本站到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 6;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>